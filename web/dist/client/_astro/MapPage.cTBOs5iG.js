import{j as o}from"./jsx-runtime.Cl1sUln5.js";import{a as l}from"./index.CtF3V91T.js";import{c as N,t as J,h as A,r as S,s as X,R as W,l as Z,v as q,u as y,P as O,n as C,A as E,m as _,w as Q,x as Y,y as ee,z as oe,C as te,F as re,D as ae,E as ne,G as se,S as k,a as M,b as T,d as D,g as R,B as w}from"./index.CbxfsRf4.js";import"./tslib.es6.Z7fC8YS6.js";import"./index.CDBGg2PS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],le=N("Plus",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ue=N("X",ie),de=({full:e,stateList:r,className:n="",data:c})=>{const t=l.useRef(null),s=c??(r&&[["Estado","Ocorrência"],...r.map(a=>[a,a])]);return l.useEffect(()=>{const a=document.createElement("script");return a.src="https://cdn.skypack.dev/@google-web-components/google-chart",a.type="module",document.body.appendChild(a),()=>{document.body.removeChild(a)}},[]),l.useEffect(()=>{if(t.current&&s){const a=document.createElement("google-chart");a.setAttribute("type","geo"),a.setAttribute("data",JSON.stringify(s)),a.setAttribute("options",JSON.stringify({region:"BR",resolution:"provinces",title:"Ocorrências"})),a.className=e?"w-full h-full":"h-[200px] w-auto",t.current.innerHTML="",t.current.appendChild(a)}},[s,e,n]),o.jsx("div",{className:J(e?"w-full h-full":"h-[200px] w-auto",n),ref:t})};function pe({className:e,...r}){return o.jsx("div",{"data-slot":"card",className:A("bg-card text-card-foreground rounded-xl border shadow-sm",e),...r})}var b="Popover",[I,Be]=Z(b,[S]),j=S(),[fe,g]=I(b),$=e=>{const{__scopePopover:r,children:n,open:c,defaultOpen:t,onOpenChange:s,modal:a=!1}=e,u=j(r),p=l.useRef(null),[f,x]=l.useState(!1),[m,i]=X({prop:c,defaultProp:t??!1,onChange:s,caller:b});return o.jsx(W,{...u,children:o.jsx(fe,{scope:r,contentId:q(),triggerRef:p,open:m,onOpenChange:i,onOpenToggle:l.useCallback(()=>i(d=>!d),[i]),hasCustomAnchor:f,onCustomAnchorAdd:l.useCallback(()=>x(!0),[]),onCustomAnchorRemove:l.useCallback(()=>x(!1),[]),modal:a,children:n})})};$.displayName=b;var z="PopoverAnchor",ve=l.forwardRef((e,r)=>{const{__scopePopover:n,...c}=e,t=g(z,n),s=j(n),{onCustomAnchorAdd:a,onCustomAnchorRemove:u}=t;return l.useEffect(()=>(a(),()=>u()),[a,u]),o.jsx(E,{...s,...c,ref:r})});ve.displayName=z;var G="PopoverTrigger",L=l.forwardRef((e,r)=>{const{__scopePopover:n,...c}=e,t=g(G,n),s=j(n),a=y(r,t.triggerRef),u=o.jsx(O.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":U(t.open),...c,ref:a,onClick:C(e.onClick,t.onOpenToggle)});return t.hasCustomAnchor?u:o.jsx(E,{asChild:!0,...s,children:u})});L.displayName=G;var F="PopoverPortal",[he,me]=I(F,{forceMount:void 0}),B=e=>{const{__scopePopover:r,forceMount:n,children:c,container:t}=e,s=g(F,r);return o.jsx(he,{scope:r,forceMount:n,children:o.jsx(_,{present:n||s.open,children:o.jsx(Q,{asChild:!0,container:t,children:c})})})};B.displayName=F;var P="PopoverContent",H=l.forwardRef((e,r)=>{const n=me(P,e.__scopePopover),{forceMount:c=n.forceMount,...t}=e,s=g(P,e.__scopePopover);return o.jsx(_,{present:c||s.open,children:s.modal?o.jsx(xe,{...t,ref:r}):o.jsx(Pe,{...t,ref:r})})});H.displayName=P;var ge=oe("PopoverContent.RemoveScroll"),xe=l.forwardRef((e,r)=>{const n=g(P,e.__scopePopover),c=l.useRef(null),t=y(r,c),s=l.useRef(!1);return l.useEffect(()=>{const a=c.current;if(a)return Y(a)},[]),o.jsx(ee,{as:ge,allowPinchZoom:!0,children:o.jsx(V,{...e,ref:t,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:C(e.onCloseAutoFocus,a=>{a.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:C(e.onPointerDownOutside,a=>{const u=a.detail.originalEvent,p=u.button===0&&u.ctrlKey===!0,f=u.button===2||p;s.current=f},{checkForDefaultPrevented:!1}),onFocusOutside:C(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),Pe=l.forwardRef((e,r)=>{const n=g(P,e.__scopePopover),c=l.useRef(!1),t=l.useRef(!1);return o.jsx(V,{...e,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{e.onCloseAutoFocus?.(s),s.defaultPrevented||(c.current||n.triggerRef.current?.focus(),s.preventDefault()),c.current=!1,t.current=!1},onInteractOutside:s=>{e.onInteractOutside?.(s),s.defaultPrevented||(c.current=!0,s.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const a=s.target;n.triggerRef.current?.contains(a)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&t.current&&s.preventDefault()}})}),V=l.forwardRef((e,r)=>{const{__scopePopover:n,trapFocus:c,onOpenAutoFocus:t,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:x,...m}=e,i=g(P,n),d=j(n);return te(),o.jsx(re,{asChild:!0,loop:!0,trapped:c,onMountAutoFocus:t,onUnmountAutoFocus:s,children:o.jsx(ae,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:x,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:f,onDismiss:()=>i.onOpenChange(!1),children:o.jsx(ne,{"data-state":U(i.open),role:"dialog",id:i.contentId,...d,...m,ref:r,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),K="PopoverClose",Ce=l.forwardRef((e,r)=>{const{__scopePopover:n,...c}=e,t=g(K,n);return o.jsx(O.button,{type:"button",...c,ref:r,onClick:C(e.onClick,()=>t.onOpenChange(!1))})});Ce.displayName=K;var je="PopoverArrow",be=l.forwardRef((e,r)=>{const{__scopePopover:n,...c}=e,t=j(n);return o.jsx(se,{...t,...c,ref:r})});be.displayName=je;function U(e){return e?"open":"closed"}var we=$,Re=L,Fe=B,Ne=H;function Ae({...e}){return o.jsx(we,{"data-slot":"popover",...e})}function Se({...e}){return o.jsx(Re,{"data-slot":"popover-trigger",...e})}function ye({className:e,align:r="center",sideOffset:n=4,...c}){return o.jsx(Fe,{children:o.jsx(Ne,{"data-slot":"popover-content",align:r,sideOffset:n,className:A("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 rounded-md border p-4 shadow-md outline-hidden",e),...c})})}function Oe({value:e,availableFields:r,onChange:n,className:c}){return o.jsxs(k,{value:e,onValueChange:t=>n(t),children:[o.jsx(M,{className:`text-nowrap ${c}`,children:o.jsx(T,{placeholder:"Campo"})}),o.jsx(D,{children:r.map(t=>o.jsx(R,{value:t,children:t.slice(0,1).toUpperCase()+t.slice(1)},t))})]})}function Ee({values:e,onChange:r,value:n,nullOptionLabel:c,placeholder:t="Selecione uma opção",className:s}){return o.jsxs(k,{value:n??"<clear>",onValueChange:a=>r(a==="<clear>"?null:a),children:[o.jsx(M,{className:s,children:o.jsx(T,{placeholder:t})}),o.jsxs(D,{children:[c&&o.jsx(R,{value:"<clear>",children:c},""),e.map(({label:a,value:u})=>o.jsx(R,{value:u,children:a},u))]})]})}const _e=[{label:"Plantae",value:"Plantae"},{label:"Fungi",value:"Fungi"},{label:"Animalia",value:"Animalia"}];function ke({onFilterChange:e}){const[r,n]=l.useState([]),[c,t]=l.useState(!1),s=l.useRef([]),a=["reino","filo","classe","ordem","superfamília","família","gênero","epíteto específico"],u=new Set(r.map(i=>i.field)),p=a.filter(i=>!u.has(i));l.useEffect(()=>{const i=setTimeout(()=>{const d=r.filter(v=>v.value!=="");e(d)},300);return()=>clearTimeout(i)},[r,e]);const f=()=>{const i=p[0];if(!i)return;const d={field:i,value:""};n([...r,d])},x=i=>{const d=r.filter((v,h)=>h!==i);n(d)},m=(i,d)=>{const v=[...r];v[i]&&(v[i]={...v[i],...d},n(v),d.field&&d.field!=="reino"&&setTimeout(()=>{console.log("focusing",s.current[i]),s.current[i]?.focus()},10))};return o.jsxs(Ae,{open:c,onOpenChange:t,children:[o.jsx(Se,{asChild:!0,children:o.jsxs(w,{variant:"outline",className:"w-[180px]",children:["Filtros (",r.length,")"]})}),o.jsxs(ye,{className:"w-[300px] p-4 space-y-1",children:[r.map((i,d)=>{const v=[i.field,...p];return o.jsxs("div",{className:"flex items-center",children:[o.jsx(Oe,{className:"w-[90px] rounded-e-none border-e-0 shadow-none shrink-0",value:i.field,onChange:h=>m(d,{field:h}),availableFields:v}),i.field==="reino"?o.jsx(Ee,{className:"flex-1 rounded-s-none",value:i.value||null,onChange:h=>m(d,{value:h||""}),values:_e,placeholder:"Selecione um reino"}):o.jsx("input",{ref:h=>{s.current[d]=h},type:"text",value:i.value,onChange:h=>m(d,{value:h.target.value}),className:"flex h-9 pr-8 w-full rounded-e-md border border-input bg-transparent px-3 py-1 text-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Digite o valor..."}),o.jsx(w,{className:"shrink-0 w-6",variant:"ghost",size:"icon",onClick:()=>x(d),children:o.jsx(ue,{className:"h-4 w-4"})})]},d)}),p.length>0&&o.jsxs(w,{variant:"outline",className:"mt-2 w-full",onClick:f,children:[o.jsx(le,{className:"mr-2 h-4 w-4"}),"Adicionar filtro"]})]})]})}const Me=new Intl.NumberFormat,Te={reino:"kingdom",filo:"phylum",classe:"class",ordem:"order",superfamília:"superfamily",família:"family",gênero:"genus","epíteto específico":"specificEpithet"};function De({onFilterChange:e,totalCount:r}){const n=l.useCallback(c=>{const t={};c.forEach(s=>{s.value&&(t[Te[s.field]]=s.value)}),e(t)},[e]);return o.jsxs(pe,{className:"p-2 flex gap-2 items-center rounded-none",children:[o.jsx(ke,{onFilterChange:n}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"font-semibold",children:["Total: ",Me.format(r)]})]})}function He(){const[e,r]=l.useState({total:0,regions:[]}),[n,c]=l.useState(null),t=async a=>{try{const u=new URLSearchParams(a),p=await fetch(`/api/taxaCountByState?${u.toString()}`);if(!p.ok)throw new Error("Falha ao carregar dados dos estados");const f=await p.json();r(f)}catch(u){c(u instanceof Error?u.message:"Falha ao carregar dados dos estados")}},s=l.useCallback(a=>{t(a)},[]);return l.useEffect(()=>{t({})},[]),o.jsxs("div",{className:"h-screen w-screen flex flex-col overflow-hidden",children:[o.jsx(De,{onFilterChange:s,totalCount:e.total}),n?o.jsx("div",{className:"flex-1 flex items-center justify-center text-red-500",children:n}):o.jsx(de,{className:"flex-1",full:!0,data:[["Estado","Taxa"],...e.regions.map(({_id:a,count:u})=>[a,u])]})]})}export{He as default};
